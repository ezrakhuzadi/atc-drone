openapi: 3.0.3
info:
  title: ATC-Drone API
  version: "1.0.0"
  description: REST + WebSocket API for the ATC Drone Traffic Control system.
servers:
  - url: http://localhost:3000
tags:
  - name: Drones
  - name: Telemetry
  - name: Conflicts
  - name: Compliance
  - name: Routes
  - name: Geofences
  - name: Commands
  - name: Flights
  - name: Admin
paths:
  /health:
    get:
      summary: Health check
      responses:
        "200":
          description: OK
  /v1/drones/register:
    post:
      tags: [Drones]
      summary: Register a drone
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "201":
          description: Registered
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegisterResponse"
  /v1/drones:
    get:
      tags: [Drones]
      summary: List registered drones
      parameters:
        - in: query
          name: owner_id
          schema:
            type: string
      responses:
        "200":
          description: Drones
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DroneState"
  /v1/drones/{drone_id}:
    get:
      tags: [Drones]
      summary: Get a registered drone
      parameters:
        - in: path
          name: drone_id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Drone
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DroneState"
        "404":
          description: Not found
  /v1/traffic:
    get:
      tags: [Drones]
      summary: List traffic (local + optional external)
      parameters:
        - in: query
          name: owner_id
          schema:
            type: string
        - in: query
          name: include_external
          schema:
            type: boolean
        - in: query
          name: source
          schema:
            type: string
        - in: query
          name: external_only
          schema:
            type: boolean
      responses:
        "200":
          description: Traffic
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TrafficState"
  /v1/telemetry:
    post:
      tags: [Telemetry]
      summary: Submit telemetry
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Telemetry"
      responses:
        "202":
          description: Accepted
  /v1/conflicts:
    get:
      tags: [Conflicts]
      summary: List active conflicts
      parameters:
        - in: query
          name: owner_id
          schema:
            type: string
      responses:
        "200":
          description: Conflicts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Conflict"
  /v1/compliance/limits:
    get:
      tags: [Compliance]
      summary: Get compliance thresholds
      responses:
        "200":
          description: Limits
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ComplianceLimits"
  /v1/compliance/evaluate:
    post:
      tags: [Compliance]
      summary: Evaluate route compliance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ComplianceEvaluateRequest"
      responses:
        "200":
          description: Evaluation result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ComplianceEvaluateResponse"
  /v1/routes/plan:
    post:
      tags: [Routes]
      summary: Plan a route with obstacle avoidance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoutePlanRequest"
      responses:
        "200":
          description: Planned route
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoutePlanResponse"
  /v1/geofences:
    get:
      tags: [Geofences]
      summary: List geofences
      responses:
        "200":
          description: Geofences
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Geofence"
    post:
      tags: [Geofences]
      summary: Create geofence
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GeofenceRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Geofence"
  /v1/geofences/{id}:
    get:
      tags: [Geofences]
      summary: Get geofence
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Geofence
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Geofence"
    put:
      tags: [Geofences]
      summary: Update geofence
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GeofenceRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Geofence"
    delete:
      tags: [Geofences]
      summary: Delete geofence
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Deleted
  /v1/geofences/check:
    get:
      tags: [Geofences]
      summary: Check a point against active geofences
      parameters:
        - in: query
          name: lat
          required: true
          schema:
            type: number
        - in: query
          name: lon
          required: true
          schema:
            type: number
        - in: query
          name: altitude_m
          required: false
          schema:
            type: number
      responses:
        "200":
          description: Result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PointCheckResponse"
  /v1/geofences/check-route:
    post:
      tags: [Geofences]
      summary: Check route against geofences
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RouteCheckRequest"
      responses:
        "200":
          description: Result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RouteCheckResponse"
  /v1/commands:
    get:
      tags: [Commands]
      summary: List pending commands
      responses:
        "200":
          description: Commands
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Command"
    post:
      tags: [Commands]
      summary: Issue command
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/IssueCommandRequest"
      responses:
        "200":
          description: Queued
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IssueCommandResponse"
  /v1/commands/next:
    get:
      tags: [Commands]
      summary: Poll next command
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: drone_id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Command
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Command"
                nullable: true
  /v1/commands/ack:
    post:
      tags: [Commands]
      summary: Acknowledge command
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AckCommandRequest"
      responses:
        "200":
          description: Acknowledged
  /v1/commands/ws:
    get:
      tags: [Commands]
      summary: WebSocket command stream
      description: |
        WebSocket stream for command push. Pass Authorization: Bearer <session_token>
        or a token query param plus optional drone_id filter.
      parameters:
        - in: query
          name: token
          schema:
            type: string
        - in: query
          name: drone_id
          schema:
            type: string
      x-websocket: true
  /v1/ws:
    get:
      summary: WebSocket realtime stream
      description: WebSocket stream for realtime drone updates.
      parameters:
        - in: query
          name: token
          schema:
            type: string
        - in: query
          name: owner_id
          schema:
            type: string
        - in: query
          name: drone_id
          schema:
            type: string
      x-websocket: true
  /v1/flights:
    get:
      tags: [Flights]
      summary: List flight plans
      parameters:
        - in: query
          name: owner_id
          schema:
            type: string
      responses:
        "200":
          description: Flight plans
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/FlightPlan"
    post:
      tags: [Flights]
      summary: Create flight plan (compat)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: "#/components/schemas/FlightPlanRequest"
                - $ref: "#/components/schemas/PlannerFlightRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FlightPlan"
  /v1/flights/plan:
    post:
      tags: [Flights]
      summary: Create flight plan
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FlightPlanRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FlightPlan"
  /v1/rid/view:
    post:
      tags: [Drones]
      summary: Update RID view bounding box
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RidViewRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RidViewResponse"
  /v1/conformance:
    get:
      tags: [Drones]
      summary: List conformance statuses
      parameters:
        - in: query
          name: owner_id
          schema:
            type: string
      responses:
        "200":
          description: Conformance statuses
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ConformanceStatus"
  /v1/daa:
    get:
      tags: [Drones]
      summary: List DAA advisories
      parameters:
        - in: query
          name: owner_id
          schema:
            type: string
        - in: query
          name: active_only
          schema:
            type: boolean
      responses:
        "200":
          description: Advisories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DaaAdvisory"
  /v1/admin/reset:
    post:
      tags: [Admin]
      summary: Reset all server state
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AdminResetRequest"
      responses:
        "200":
          description: Reset complete
  /v1/admin/drones/{drone_id}/token/rotate:
    post:
      tags: [Admin]
      summary: Rotate a drone session token
      description: Generates a new session token for a registered drone and invalidates the old token.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: drone_id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Token rotated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegisterResponse"
        "404":
          description: Drone not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  drone_id:
                    type: string
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: UUID
  schemas:
    RegisterRequest:
      type: object
      properties:
        drone_id:
          type: string
        owner_id:
          type: string
        drone_type:
          type: string
      required: []
    RegisterResponse:
      type: object
      required: [drone_id, session_token]
      properties:
        drone_id:
          type: string
        session_token:
          type: string
    Telemetry:
      type: object
      required: [drone_id, lat, lon, altitude_m, timestamp]
      properties:
        drone_id:
          type: string
        owner_id:
          type: string
        lat:
          type: number
          format: double
        lon:
          type: number
          format: double
        altitude_m:
          type: number
          format: double
        heading_deg:
          type: number
        speed_mps:
          type: number
        velocity_x:
          type: number
        velocity_y:
          type: number
        velocity_z:
          type: number
        timestamp:
          type: string
          format: date-time
    DroneState:
      type: object
      properties:
        drone_id:
          type: string
        owner_id:
          type: string
        lat:
          type: number
        lon:
          type: number
        altitude_m:
          type: number
        heading_deg:
          type: number
        speed_mps:
          type: number
        velocity_x:
          type: number
        velocity_y:
          type: number
        velocity_z:
          type: number
        last_update:
          type: string
          format: date-time
        status:
          type: string
    TrafficState:
      type: object
      properties:
        drone_id:
          type: string
        owner_id:
          type: string
        lat:
          type: number
        lon:
          type: number
        altitude_m:
          type: number
        heading_deg:
          type: number
        speed_mps:
          type: number
        last_update:
          type: string
          format: date-time
        status:
          type: string
        traffic_source:
          type: string
    Conflict:
      type: object
      properties:
        drone1_id:
          type: string
        drone2_id:
          type: string
        distance_m:
          type: number
        severity:
          type: string
        time_to_closest:
          type: number
        closest_distance_m:
          type: number
        cpa_lat:
          type: number
        cpa_lon:
          type: number
        cpa_altitude_m:
          type: number
        timestamp:
          type: number
    Geofence:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        geofence_type:
          type: string
        polygon:
          type: array
          items:
            type: array
            items:
              type: number
        lower_altitude_m:
          type: number
        upper_altitude_m:
          type: number
        active:
          type: boolean
    GeofenceRequest:
      type: object
      properties:
        name:
          type: string
        geofence_type:
          type: string
        polygon:
          type: array
          items:
            type: array
            items:
              type: number
        lower_altitude_m:
          type: number
        upper_altitude_m:
          type: number
      required: [name, geofence_type, polygon]
    RouteCheckRequest:
      type: object
      properties:
        waypoints:
          type: array
          items:
            $ref: "#/components/schemas/Waypoint"
      required: [waypoints]
    RouteCheckResponse:
      type: object
      properties:
        conflicts:
          type: boolean
        conflicting_geofences:
          type: array
          items:
            $ref: "#/components/schemas/GeofenceConflict"
    GeofenceConflict:
      type: object
      properties:
        geofence_id:
          type: string
        geofence_name:
          type: string
        segment_index:
          type: integer
    PointCheckResponse:
      type: object
      properties:
        inside_geofence:
          type: boolean
        geofence_ids:
          type: array
          items:
            type: string
    Waypoint:
      type: object
      properties:
        lat:
          type: number
        lon:
          type: number
        altitude_m:
          type: number
        speed_mps:
          type: number
    TrajectoryPoint:
      type: object
      properties:
        lat:
          type: number
        lon:
          type: number
        altitude_m:
          type: number
        time_offset_s:
          type: number
    Command:
      type: object
      properties:
        command_id:
          type: string
        drone_id:
          type: string
        command_type:
          $ref: "#/components/schemas/CommandType"
        issued_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time
        acknowledged:
          type: boolean
    CommandType:
      oneOf:
        - $ref: "#/components/schemas/CommandHold"
        - $ref: "#/components/schemas/CommandAltitudeChange"
        - $ref: "#/components/schemas/CommandReroute"
        - $ref: "#/components/schemas/CommandResume"
      discriminator:
        propertyName: type
    CommandHold:
      type: object
      required: [type, duration_secs]
      properties:
        type:
          type: string
          enum: [HOLD]
        duration_secs:
          type: integer
    CommandAltitudeChange:
      type: object
      required: [type, target_altitude_m]
      properties:
        type:
          type: string
          enum: [ALTITUDE_CHANGE]
        target_altitude_m:
          type: number
    CommandReroute:
      type: object
      required: [type, waypoints]
      properties:
        type:
          type: string
          enum: [REROUTE]
        waypoints:
          type: array
          items:
            $ref: "#/components/schemas/Waypoint"
        reason:
          type: string
    CommandResume:
      type: object
      required: [type]
      properties:
        type:
          type: string
          enum: [RESUME]
    IssueCommandRequest:
      allOf:
        - type: object
          required: [drone_id]
          properties:
            drone_id:
              type: string
            owner_id:
              type: string
            expires_in_secs:
              type: integer
        - $ref: "#/components/schemas/CommandType"
    IssueCommandResponse:
      type: object
      properties:
        command_id:
          type: string
        drone_id:
          type: string
        status:
          type: string
    AckCommandRequest:
      type: object
      properties:
        command_id:
          type: string
      required: [command_id]
    PlannerWaypoint:
      type: object
      properties:
        lat:
          type: number
        lon:
          type: number
        alt:
          type: number
          description: Altitude in meters (altitude_m also accepted).
        time_offset:
          type: number
          description: Seconds from start (time_offset_s also accepted).
      required: [lat, lon, alt]
    PlannerMetadata:
      type: object
      properties:
        drone_speed_mps:
          type: number
        drone_id:
          type: string
        total_distance_m:
          type: number
        total_flight_time_s:
          type: number
        trajectory_points:
          type: integer
        planned_altitude_m:
          type: number
        max_obstacle_height_m:
          type: number
        faa_compliant:
          type: boolean
        submitted_at:
          type: string
        blender_declaration_id:
          type: string
        operation_type:
          type: integer
        battery_capacity_min:
          type: number
        battery_reserve_min:
          type: number
        clearance_m:
          type: number
        compliance_override_enabled:
          type: boolean
        compliance_override_notes:
          type: string
    PlannerFlightRequest:
      type: object
      properties:
        flight_id:
          type: string
        waypoints:
          type: array
          items:
            $ref: "#/components/schemas/PlannerWaypoint"
        trajectory_log:
          type: array
          items:
            $ref: "#/components/schemas/PlannerWaypoint"
        owner_id:
          type: string
        metadata:
          $ref: "#/components/schemas/PlannerMetadata"
      required: [flight_id, waypoints, trajectory_log]
    FlightPlanRequest:
      type: object
      properties:
        drone_id:
          type: string
        owner_id:
          type: string
        waypoints:
          type: array
          items:
            $ref: "#/components/schemas/Waypoint"
        trajectory_log:
          type: array
          items:
            $ref: "#/components/schemas/TrajectoryPoint"
        metadata:
          $ref: "#/components/schemas/FlightPlanMetadata"
        origin:
          $ref: "#/components/schemas/Waypoint"
        destination:
          $ref: "#/components/schemas/Waypoint"
        departure_time:
          type: string
          format: date-time
      required: [drone_id]
    FlightPlan:
      type: object
      properties:
        flight_id:
          type: string
        drone_id:
          type: string
        owner_id:
          type: string
        waypoints:
          type: array
          items:
            $ref: "#/components/schemas/Waypoint"
        trajectory_log:
          type: array
          items:
            $ref: "#/components/schemas/TrajectoryPoint"
        metadata:
          $ref: "#/components/schemas/FlightPlanMetadata"
        status:
          type: string
        departure_time:
          type: string
          format: date-time
        arrival_time:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
    FlightPlanMetadata:
      type: object
      properties:
        drone_speed_mps:
          type: number
        total_distance_m:
          type: number
        total_flight_time_s:
          type: number
        trajectory_points:
          type: integer
        planned_altitude_m:
          type: number
        max_obstacle_height_m:
          type: number
        faa_compliant:
          type: boolean
        submitted_at:
          type: string
        blender_declaration_id:
          type: string
        operation_type:
          type: integer
        battery_capacity_min:
          type: number
        battery_reserve_min:
          type: number
        clearance_m:
          type: number
        compliance_override_enabled:
          type: boolean
        compliance_override_notes:
          type: string
        compliance_report:
          type: object
    ComplianceLimits:
      type: object
      properties:
        maxWindMps:
          type: number
        maxGustMps:
          type: number
        maxPrecipMm:
          type: number
        windWarnRatio:
          type: number
        batteryWarnMarginMin:
          type: number
        populationBvlosMax:
          type: number
        populationWarn:
          type: number
        populationAbsoluteMax:
          type: number
        defaultClearanceM:
          type: number
    ComplianceEvaluateRequest:
      type: object
      properties:
        drone_id:
          type: string
        owner_id:
          type: string
        waypoints:
          type: array
          items:
            $ref: "#/components/schemas/Waypoint"
        trajectory_log:
          type: array
          items:
            $ref: "#/components/schemas/TrajectoryPoint"
        metadata:
          $ref: "#/components/schemas/FlightPlanMetadata"
        origin:
          $ref: "#/components/schemas/Waypoint"
        destination:
          $ref: "#/components/schemas/Waypoint"
        departure_time:
          type: string
          format: date-time
    ComplianceEvaluateResponse:
      type: object
      properties:
        ok:
          type: boolean
        blocking:
          type: array
          items:
            type: string
        violations:
          type: array
          items:
            type: object
        report:
          $ref: "#/components/schemas/ComplianceReport"
          nullable: true
    ComplianceReport:
      type: object
      properties:
        generated_at:
          type: string
        overall_status:
          $ref: "#/components/schemas/ComplianceStatus"
        route:
          $ref: "#/components/schemas/RouteMetrics"
        checks:
          $ref: "#/components/schemas/ComplianceChecks"
    ComplianceStatus:
      type: string
      enum: [pass, warn, fail, pending]
    RouteMetrics:
      type: object
      properties:
        distance_m:
          type: number
        estimated_minutes:
          type: number
        has_route:
          type: boolean
    ComplianceChecks:
      type: object
      properties:
        weather:
          $ref: "#/components/schemas/WeatherCheck"
        battery:
          $ref: "#/components/schemas/BatteryCheck"
        population:
          $ref: "#/components/schemas/PopulationCheck"
        obstacles:
          $ref: "#/components/schemas/ObstaclesCheck"
    WeatherCheck:
      type: object
      properties:
        status:
          $ref: "#/components/schemas/ComplianceStatus"
        message:
          type: string
        wind_mps:
          type: number
        gust_mps:
          type: number
        precip_mm:
          type: number
        max_wind_mps:
          type: number
        max_gust_mps:
          type: number
        max_precip_mm:
          type: number
        source:
          type: string
    BatteryCheck:
      type: object
      properties:
        status:
          $ref: "#/components/schemas/ComplianceStatus"
        message:
          type: string
        estimated_minutes:
          type: number
        capacity_min:
          type: number
        reserve_min:
          type: number
        remaining_min:
          type: number
        cruise_speed_mps:
          type: number
    PopulationCheck:
      type: object
      properties:
        status:
          $ref: "#/components/schemas/ComplianceStatus"
        message:
          type: string
        density:
          type: number
        classification:
          type: string
        building_count:
          type: integer
        estimated_population:
          type: number
        area_km2:
          type: number
        source:
          type: string
    ObstaclesCheck:
      type: object
      properties:
        status:
          $ref: "#/components/schemas/ComplianceStatus"
        message:
          type: string
        clearance_m:
          type: number
        conflicts:
          type: array
          items:
            $ref: "#/components/schemas/ObstacleConflict"
        hazards:
          type: array
          items:
            $ref: "#/components/schemas/ObstacleHazard"
        obstacle_count:
          type: integer
        truncated:
          type: boolean
    ObstacleConflict:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        distance_m:
          type: number
        severity:
          type: string
    ObstacleHazard:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        lat:
          type: number
        lon:
          type: number
        radius_m:
          type: number
        height_m:
          type: number
        hazard_type:
          type: string
        source:
          type: string
        distance_m:
          type: number
    RoutePlanRequest:
      type: object
      properties:
        waypoints:
          type: array
          items:
            $ref: "#/components/schemas/Waypoint"
        lane_radius_m:
          type: number
        lane_spacing_m:
          type: number
        sample_spacing_m:
          type: number
        safety_buffer_m:
          type: number
        max_lane_radius_m:
          type: number
        lane_expansion_step_m:
          type: number
      required: [waypoints]
    RoutePlanResponse:
      type: object
      properties:
        ok:
          type: boolean
        waypoints:
          type: array
          items:
            $ref: "#/components/schemas/RouteEngineWaypoint"
        stats:
          $ref: "#/components/schemas/RouteEngineStats"
          nullable: true
        nodes_visited:
          type: integer
        optimized_points:
          type: integer
        sample_points:
          type: integer
        hazards:
          type: array
          items:
            $ref: "#/components/schemas/ObstacleHazard"
        errors:
          type: array
          items:
            type: string
    RouteEngineWaypoint:
      type: object
      properties:
        lat:
          type: number
        lon:
          type: number
        altitude_m:
          type: number
        phase:
          type: string
    RouteEngineStats:
      type: object
      properties:
        avg_agl:
          type: number
        max_agl:
          type: number
        max_altitude:
          type: number
    RidViewRequest:
      type: object
      properties:
        min_lat:
          type: number
        min_lon:
          type: number
        max_lat:
          type: number
        max_lon:
          type: number
      required: [min_lat, min_lon, max_lat, max_lon]
    RidViewResponse:
      type: object
      properties:
        view:
          type: string
    ConformanceStatus:
      type: object
      properties:
        drone_id:
          type: string
        owner_id:
          type: string
        status:
          type: string
        last_checked:
          type: string
          format: date-time
        record:
          $ref: "#/components/schemas/ConformanceRecord"
    ConformanceRecord:
      type: object
      properties:
        id:
          type: string
        flight_declaration_id:
          type: string
        aircraft_id:
          type: string
        conformance_state:
          type: integer
        conformance_state_label:
          type: string
        conformance_state_code:
          type: string
        timestamp:
          type: string
        description:
          type: string
        event_type:
          type: string
        geofence_breach:
          type: boolean
        geofence_id:
          type: string
        resolved:
          type: boolean
        created_at:
          type: string
        updated_at:
          type: string
    DaaAdvisory:
      type: object
      properties:
        advisory_id:
          type: string
        drone_id:
          type: string
        owner_id:
          type: string
        source:
          type: string
        severity:
          type: string
        action:
          type: string
        description:
          type: string
        related_id:
          type: string
        record:
          $ref: "#/components/schemas/ConformanceRecord"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        resolved:
          type: boolean
    AdminResetRequest:
      type: object
      properties:
        confirm:
          type: string
        require_idle:
          type: boolean
      required: [confirm]
